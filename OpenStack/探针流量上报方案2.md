



## 1. 拓扑图



![1](D:\文档整理\OpenStack\探针流量上报方案测试\1.jpg)

操作步骤:

1. 每创建一个场景需要创建一个对应的路由器，比如场景1，对应的Router01
2. 创建内部网络1，添加静态路由，到 探针server 的下一跳 给  R1接口IP地址 例如: 10.100.7.146/32,192.168.1.220
3. 创建内部网络1时需要开启DHCP功能(给虚拟机推送静态路由)
4. 每个内部网络预留一个IP地址，本次示例为192.168.1.220；外部网络，每个场景占用一个外部网络IP地址，实现 SNAT功能。
5. Router01 和 内网网络1相连接，并配置对应IP地址，例如: 192.168.1.220(不能和真实网络冲突)，Router01连接oj_ext网络，并配置oj_ext 分配的地址是外部网关，实现SNAT功能。

方案优势:

	1. 针对探针 server 容易扩展，后期 探针 server如果部署在 openstack环境之外也可以适用。
 	2. 安全性，客户端通过静态路由只能访问到 探针 server 和 互联路由器SNAT接口地址，别的外网机器访问不到。
 	3. 简单易用，方便后期维护。



## 2. 测试步骤

1. 创建路由器Router01

   > 注意点: 这里的IP地址，尽量不要和默认网关的IP地址冲突

   Router01连接外部网络，充当外部网络网关

![image-20211208141955019](D:\文档整理\OpenStack\探针流量上报方案测试\image-20211208141955019.png)

![image-20211208142556071](D:\文档整理\OpenStack\探针流量上报方案测试\image-20211208142556071.png)



2. 创建内网网络01

![image-20211208141658550](D:\文档整理\OpenStack\探针流量上报方案测试\image-20211208141658550.png)



3. Router01连接内部网络

![image-20211208142104271](D:\文档整理\OpenStack\探针流量上报方案测试\image-20211208142104271.png)

3. 创建虚拟机client和server

![image-20211208142146673](D:\文档整理\OpenStack\探针流量上报方案测试\image-20211208142146673.png)

![image-20211208142256049](D:\文档整理\OpenStack\探针流量上报方案测试\image-20211208142256049.png)

![image-20211208143829511](D:\文档整理\OpenStack\探针流量上报方案测试\image-20211208143829511.png)

![image-20211208143903204](D:\文档整理\OpenStack\探针流量上报方案测试\image-20211208143903204.png)