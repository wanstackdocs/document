## 1. 部署方式
1）用户安装操作系统 CentOS8.4

2）用户安装cpmg系统

3）登录cpmg系统，创建openstack环境，使用cobbler安装操作系统8.4，节点发现，添加openstack节点，选择node角色(控制节点，计算节点，存储节点)， 修改配置文件，安装openstack集群环境

## 2. 功能列表
### 1. 用户管理(system)
仅存一个管理员账号信息，可以修改自己的密码功能。


### 2. 安装配置(manage)
1. openstack环境管理(增、删、改、查、详情信息)

2. node管理，节点发现
1）使用cobbler 安装操作系统，仅仅配置pex网络网卡地址, pex网络和集群网络网卡复用，安装完成操作系统后

2）节点发现 -- 发现安装好的操作系统，仅发现已经安装好的机器 -->  # 定时任务？？？
信息：IP地址(pex网卡)、网卡名称、MAC地址信息、CPU信息、内存信息、硬盘信息、ssh port，root账号，root密码/公钥

3) 添加节点 关联角色(控制节点、计算节点、ALL_IN_ONE)

3.1) 删除节点（计算节点），删除数据库记录，删除openstack相关信息
3.2） 发现已经存在的节点(手动触发)

3）网卡和网卡tag进行关联配置

3. 配置管理 -- 网络配置、账号配置

1）网络配置: 主要配置，在配置上联 交换机时，公开（外部）网络单独划分VLAN ID ， 集群网络、BR-MIRROR 网络 务必配置成同一个VLAN ，BR-VLAN网络配置成TRUNK模式

网卡tag：网卡和网卡tag进行关联，然后配置网卡tag
- 公开，br-ex, web访问dashboard
公共网络允许从外部网络（例如Internet）到虚拟机的向内网络连接，以及从虚拟机到外部网络的向外网络连接。
CIDR(子网掩码)10.100.7.0/24，IP RANGE(10.100.7.1,10.100.7.99), 网关(10.100.7.254)

下面的地址段范围 不能和上面的 IP RANGE 重合
EX_GATEWAY="10.100.7.254"
LOCAL_CIDR="10.100.7.0/24"
IP_POOL_START="10.100.7.100"
IP_POOL_END="10.100.7.200"

- 集群，主机解析，集群内部API通信，比如nova-api 访问 neutron-api接口等
CIDR(子网掩码, 192.168.7.0/24)，IP RANGE(192.168.7.1,192.168.7.200)   pex网络和集群网络网卡复用。
首先使用pex网络进行DHCP分配，分配的地址记录在数据库种，再安装openstack环境时，写静态IP地址。

- BR-MIRROR， 不配置IP地址 ，预配置IP地址 10.10.7.0/24

- BR-VLAN 此网卡上联交换机必须为TRUNK，不配置IP地址, 不进行预先配置，如果上联口没配置为trunk，只影响使用，不影响安装



2. 每个节点一个配置文件。使用这种方式



连通性检查，
对所有节点进行预配置IP地址信息，然后相互ping，如果没问题，则配置正确(清理预分配的IP地址)，有问题，则报错。


账号配置：

admin用户密码（可编辑）
ADMIN_PASSWD=7gqiMnynHErdrjc

admin.openrc , keystone user 



openstack模块化管理: 是否以插件形式提供选择模块安装, 支持，默认全部安装。



### 添加角色
举例: 控制节点安装成后，再加入计算角色，再加入存储角色


### 3. 日志配置:
LOKI C/S ,配置文件暂时未提供，搜集openstack安装信息日志，搜集openstack运行日志。

### 4. 安装部署: 
ansible获取node节点信息，分配完成角色，先安装控制节点，然后安装计算节点（批量，是否规定上限）。
关于回退: 安装过程中如果安装失败，回退是否可以使用cobbler重新安装操作系统，需要人工干预从网络启动。


### 5. 节点管理: webssh管理
从node节点中获取响应信息进行webssh连接



调研：cobbler，LOKI


熊磊：webssh：cockpit